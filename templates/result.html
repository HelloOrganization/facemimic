<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>我的表情模仿指数是......</title>
    <!-- Bootstrap -->
	<link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.2/css/bootstrap.min.css">
	<!--<link rel="stylesheet" href="css/bootstrap.min.css">-->
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
	
  </head>
  
  
  
  <body style ="background-color: #FFD306">
	
	<nav class="navbar navbar-static-top navbar-inverse">
        <div class="container">
			
			<div class="navbar-header">
				<!--
			  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			  </button>
				-->
			  <a class="navbar-brand" href="#" ><strong>表情模仿秀</strong></a>
			  <div class="navbar-brand navbar-right pull-right">
			  		记得分享哦<span class="glyphicon glyphicon-arrow-up"></span>
			  </div>
			</div>
			<!--
			<div id="navbar" class="collapse navbar-collapse">
			 <ul class="nav navbar-nav">
				<li><a href="#">分享到XXX</a></li>
				<li><a href="#">分享到XXX</a></li>
				<li><a href="#">复制链接</a></li>
				<li><a href="#">加入收藏</a></li>
			  </ul>
			</div>
			-->
		</div>
    </nav>
	
	
		<div class="container">
			<h2>我的模仿指数是：<span id='score' class="label label-danger">{{score}}</span></h2>
			<h3>超过全国<span id="percent" class="label label-primary">{{percent}}%</span>的人</h3>
			<h3>专家点评：</h3>
			<h4 id="review_wait" style='{{wait_style}}'>正在计算中<img src="static/img/help/load.gif" id="loading">请稍等</h4>
			<h4 id="review_res"></h4>
			<div class="row">
				<div class="form-group col-md-6">
				
					<div class="">
						<h3>我的表情:</h3>				
					</div>
					
					<a class="thumbnail">
						
						 <div id="localImag1" >  
							<!--img id="preview1" alt="" class="img-thumbnail col-md-6 col-md-offset-3" src="{{preview1}}"/--> 
<img id="preview1" alt="" class="img-thumbnail col-md-6 col-md-offset-3" src="http://b.hiphotos.baidu.com/baike/c0%3Dbaike220%2C5%2C5%2C220%2C73/sign=f9526156720e0cf3b4fa46a96b2f997a/342ac65c1038534392f24b659313b07eca8088b1.jpg"/>  							
						</div> 
					</a>
				</div>
				<div class="form-group col-md-6">
					<div class="">
						<h3>我所模仿的表情:</h3>						
					</div>
					<a class="thumbnail">
						
						<div id="localImag2" >  
							<img id="preview2" alt="" class="img-thumbnail"  src="{{preview2}}"/>  
						</div> 
					</a>
				</div>
			</div>
			<div class="row " style="text-align: center">
				<div class="" style="margin: auto" >
					<button href="/"  class="btn btn-lg btn-danger">{{btnInfo}}</button>
					<button id="zan" class="btn  btn-lg btn-primary" onclick='$("#zan").attr("disabled", "disabled");$("#zan").attr("disabled", "disabled");$("#zan").html("已有6个人点赞");'>点个赞！</button>				
				</div>
			</div>
		</div>
	<br/><br/><br/>
	<!--
   <nav class="navbar navbar-fixed-bottom navbar-inverse">
        <span class="navbar-text"style="font-family:Palatino Linotype">Designed by Qingying Chen, Yiqun Ouyang, Minxing Liu, Yangqingwei Shi, Peking University.</span>
    </nav>
    -->
      <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <!--script src="http://cdn.bootcss.com/jquery/1.11.2/jquery.min.js"></script-->
	<script src="http://cdn.bootcss.com/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
   <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
	<script src="http://cdn.bootcss.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="static/js/jquery.cookie.js"></script>
	<script type="text/javascript" src="static/js/facepp-sdk.min.js"></script>
	<script type="text/javascript">

		var review=["你对面部动作、眼神、情绪的把握已经臻于化境！天哪，我还以为你是这些表情的原型，而不是它们的模仿！","非……非常好，就是这种感觉！令人潸然泪下的感人模仿！请务必分享到朋友圈让大家看看……","出人意料的良好表现！这次模仿令我印象深刻，我会记住你的。", "哎唷不错~我觉得已经很像了！不过如果你觉得你的技艺不止于此的话，那么请继续前进吧！", "想象一下图中的人物是怀着何等心情做出这样的表情的，他又遇到了什么样的夸张事情，然后再假象自己置身其中，体会同样的情绪，最后大胆地表现出来！你一定可以的！再来一次吧~","呀！模仿还需继续努力哦~再来一次吧！或者分享到朋友圈让他人评点！节操什么的就不要太在意啦。", "咦？0分？不要惊慌，可能是我们没有在照片中检测到人脸，也可能是拍摄姿势不对，记住要拿起手机竖着拍摄哦！不如再来一次！"];

		/*var srcStr = localStorage.getItem('test');//获取本地存储的元素
   		var imgobj =  document.getElementById("preview1")
   		imgobj.src = $.cookie('url');//指定图片路径
   		console.log($.cookie('url'));*/
   		//$("#preview2").attr("src", $.cookie("dst_img"));

   		if ($.cookie('ajax') == '1'){
   			var facepp_res = -1;
			var api = new FacePP('990cf5b3dead0a169422ab869d575319',
				'E5lCgmKRHYjj9rtVecjngoTI4ArbK9w7', {
				apiURL: 'http://apicn.faceplusplus.com/v2'
			}); 
			api.request('detection/detect', {
				url:'{{preview1}}'
			}, function(err, result) {
    			if (err) {
        			return;
    			}
    			facepp_res = result['face'].length;
    			console.log('facepp_res: ' + facepp_res);
    		});
   			var sight_res = -1;
    		var parsedData = null;
   			console.log('use ajax');
	   		var url = '/calc?uuid=' + $.cookie('uuid');
			console.log(url);
			$.get(url, function(data, status) {
				console.log('req res:' + data);
				parsedData = JSON.parse(data.replace(/'/g, '"'));
				sight_res = 1;
			});
			function checkRes(){
				if (facepp_res < 0 || sight_res < 0){
					//console.log(new Date());
					setTimeout(checkRes, 1000);
					return;
				}
				if (facepp_res == 0){
					parsedData = [0, 0, 6, 666, 'facepp:no face'];
				}
				console.log(parsedData);
				$('#score').text(parsedData[0]);
				$('#percent').text(parsedData[1] + "%");
				$('#review_wait').hide();
				$('#review_res').text(review[parseInt(parsedData[2])]);
				$(document).attr("title", '我在表情模仿达人赛中得分'+parsedData[0]+',超过了'+parsedData[1]+'%的人,不服来战');
				//console.log('end');
				var facepp_url = '/facepp?leanId='+$.cookie("leanId") +"&res="+facepp_res;
				$.get(facepp_url, function(data, status) {
					console.log('facepp' + data);
				});
			}
			checkRes();
		} else{
			$('#review_res').text(review[{{review}}]);
		}
  		

   			//document.body.appendChild(imgobj);//在页面中添加元素
	</script>
   </body>
</html>