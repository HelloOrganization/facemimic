<!DOCTYPE html>
<html lang="zh-cn">
<head>
	<meta charset="utf8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Marvelous Imitator of facial expressions!!</title>
	<!-- Bootstrap -->
	<link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.2/css/bootstrap.min.css">

	<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
	<script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
	<![endif]-->

	<script type="text/javascript">
	 <!--
		function restoreImg(srcpicid,textid)
		{
			
			// window.alert(srcpicid.src);
			 textid.value=srcpicid.src;
		}
		function myAlert() {
			window.alert("Hello");     
	    }
	 --> </script>
	 <script type="text/javascript">
		$(document).ready(function(){
			  $("#getpic").click(function(){
				$("#uploadFileId").toggle(400);
			});
		});
		$(document).ready(function(){
			  $("#uploadFileId").click(function(){
				$("#cal").show(400);
			});
		});
	</script>
	<script type="text/javascript">
<!--		
            function setImagePreview(docObj,localImagId,imgObjPreview)   
            {  
                if(docObj.files && docObj.files[0])  
                {  
					//火狐下，直接设img属性  
                    imgObjPreview.style.display = 'block';  
                   // imgObjPreview.style.width = '1366px';  
                    //imgObjPreview.style.height = '768px';                      
      
      
                    //火狐7以上版本不能用上面的getAsDataURL()方式获取，需要一下方式    
                    imgObjPreview.src = window.URL.createObjectURL(docObj.files[0]);  
                }  
                else  
                {  
                    //IE下，使用滤镜  
                    docObj.select();  
                    var imgSrc = document.selection.createRange().text;  
                      
                    //必须设置初始大小  
                    //localImagId.style.width = "1366px";  
                    //localImagId.style.height = "768px";  
                      
                    //图片异常的捕捉，防止用户修改后缀来伪造图片  
                    try  
                    {  
                        localImagId.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)";  
                        localImagId.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src = imgSrc;  
                     }  
                     catch(e)  
                     {  
                        alert("您上传的图片格式不正确，请重新选择!");  
                        return false;  
                      }                            
                      imgObjPreview.style.display = 'none';  
                      document.selection.empty();  
                }  
                return true;  
            }  
			--> </script>

</head>

<body style ="background-color: #FFD306">
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" 
	   aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" 
				   data-dismiss="modal" aria-hidden="true">&times;</button>
					<h4 class="modal-title" id="myModalLabel">欢迎使用表情模仿秀！</h4>
				</div>
				<div class="modal-body">
					<p>想成为表情模仿达人吗？摆脱扑克脸，发现自己丰富多彩的表情吧！本应用会随机给出一个表情，您模仿的越像，“模仿指数”越高哦~</p>
					<p>步骤一：点击最左的按钮，来看看自己想要模仿的表情是什么。</p>
					<p>步骤二：感觉不是很对？那么换一个来模仿吧！</p>
					<p>步骤三：记下这个表情的精髓！然后默默准备好表情，越像越传神越好~</p>
					<p>步骤四：拍照或者上传你的模仿秀照片~来看看你的“模仿指数”是多少吧~</p>
					<p>下面是样例哟：</p>
					<img id="example" class="img-thumbnail" alt="" src="/static/img/help/example.jpg"/>

				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" 
				   data-dismiss="modal">关闭</button>
				</div>
			</div>
			<!-- /.modal-content -->
		</div>
	</div>
	<!-- /.modal -->
	<nav class="navbar navbar-static-top navbar-inverse">
		<div class="container">
			<a href="#"class="navbar-brand navbar-right" data-toggle="modal" data-target="#myModal">→_→怎么玩嘛</a>

		</div>
	</nav>

	<!--弹出模态框说明玩法，初始的图片展示栏，两个按钮：看看模仿什么表情、换一个。上传照片，提交-->
	<div class="container">
		<div class="row" style="text-align: center">
			<h1 style="font-family:Palatino Linotype margin: auto">表情模仿秀</h1>
		</div>
		<br/>
		<br/>

		<!--
			<button type="button" class="btn btn-info col-xs-6 col-lg-6" onclick='$.get("/another", function(data){console.log(data); $("#preview2").attr("src", data);});'>DUANG！换一个</button>
	-->
	<div id="localImag2" class=""style="width: 100%; text-align: center">
		<img id="preview2" class="img-thumbnail" alt="" src="/static/img/help/black.png" style="background-color: #FFD306; border: #FFD306"/>
		<!--onload="javascript:restoreImg(preview2,pic1);" onchange="javascript:restoreImg(preview2,pic1);" />-->
	</div>
	<button id="getpic" type="button" class="btn btn-info col-xs-10 col-xs-offset-1 col-lg-6" onclick='$.get("/another", function(data){console.log(data); $("#preview2").attr("src", data); $.cookie("dst_img", data);});$("#uploadFileId").show(400);$("#getpic").html("换一个表情？");'>要模仿什么？</button>

	<button id="uploadFileId"style="display:none" class="btn btn-default col-xs-10 col-xs-offset-1" onclick=" document.getElementById('pic2').click(); $('#cal').show();">上传自己的模仿照片，尽量传神哦</button>

	<div class="row">
		<!-- 这里我随便也了个跳转，表单传了两个input：一个file一个text。-->
		<form action="/result" role="form" method="Post" enctype="multipart/form-data" id="calc_score">
			<div class="" id="localImag" style="text-align: center; background-color: #FFD306;">
				<img id="preview" alt="" style="background-color: #FFD306; border: #FFD306" class="img-thumbnail col-md-6 col-md-offset-3"/>
			</div>
			<div id="cal" class="row" style="text-align:center;display:none">
				<button type="submit" style="margin: auto" class="btn-lg btn-danger">计算我的模仿指数(╯°Д°)╯</button>
			</div>

			<input name="photo" type="file" class="btn btn-default" accept="image/*" style="visibility: hidden; margin: auto" id="pic2" onchange="javascript:setImagePreview(this,localImag,preview)" required="required">
		</form>
	</div>
</div>

<br/>
<br/>
<br/>
<nav class="navbar navbar-fixed-bottom navbar-inverse">
	<span class="navbar-text"style="font-family:Palatino Linotype">
		Designed by Qingying Chen, Yiqun Ouyang, Minxing Liu, Yangqingwei Shi, Peking University.
	</span>
</nav>
<script type="text/javascript">
<!--
	preview = document.getElementById("preview");

	preview.addEventListener("load", function () {

 		var imgCanvas = document.createElement("canvas"),
 		imgContext = imgCanvas.getContext("2d");
		// 确保canvas元素的大小和图片尺寸一致
		imgCanvas.width = preview.width;
		imgCanvas.height = preview.height;

		// 渲染图片到canvas中
		imgContext.drawImage(preview, 0, 0, imgCanvas.width, imgCanvas.height);
		// 用data url的形式取出
		var imgAsDataURL = imgCanvas.toDataURL("image/png");
		// 保存到本地存储中
		try {
			localStorage.setItem("test", imgAsDataURL);
		}catch (e) {
			console.log("Storage failed: " + e);
		}
	}, false);
-->
</script>
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="http://cdn.bootcss.com/jquery/1.11.2/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="http://cdn.bootcss.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="static/js/jquery.cookie.js"></script>

</body>
</html>